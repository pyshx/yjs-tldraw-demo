{
  "version": 3,
  "sources": ["../../../../src/lib/primitives/geometry/Arc2d.ts"],
  "sourcesContent": ["import { Vec2d } from '../Vec2d'\nimport { intersectLineSegmentCircle } from '../intersect'\nimport { PI, PI2, shortAngleDist } from '../utils'\nimport { Geometry2d, Geometry2dOptions } from './Geometry2d'\nimport { getVerticesCountForLength } from './geometry-constants'\n\n/** @public */\nexport class Arc2d extends Geometry2d {\n\t_center: Vec2d\n\tradius: number\n\tstart: Vec2d\n\tend: Vec2d\n\n\tmeasure: number\n\tlength: number\n\tangleStart: number\n\tangleEnd: number\n\n\tconstructor(\n\t\tconfig: Omit<Geometry2dOptions, 'isFilled' | 'isClosed'> & {\n\t\t\tcenter: Vec2d\n\t\t\tradius: number\n\t\t\tstart: Vec2d\n\t\t\tend: Vec2d\n\t\t\tsweepFlag: number\n\t\t\tlargeArcFlag: number\n\t\t}\n\t) {\n\t\tsuper({ ...config, isFilled: false, isClosed: false })\n\t\tconst { center, radius, sweepFlag, largeArcFlag, start, end } = config\n\t\tif (start.equals(end)) throw Error(`Arc must have different start and end points.`)\n\n\t\t// ensure that the start and end are clockwise\n\t\tthis.angleStart = Vec2d.Angle(center, start)\n\t\tthis.angleEnd = Vec2d.Angle(center, end)\n\t\tthis.measure = getArcMeasure(this.angleStart, this.angleEnd, sweepFlag, largeArcFlag)\n\t\tthis.length = this.measure * radius\n\n\t\tthis.start = start\n\t\tthis.end = end\n\n\t\tthis._center = center\n\t\tthis.radius = radius\n\t}\n\n\tnearestPoint(point: Vec2d): Vec2d {\n\t\tconst { _center, measure, radius, angleEnd, angleStart, start: A, end: B } = this\n\t\tconst t = getPointInArcT(measure, angleStart, angleEnd, _center.angle(point))\n\t\tif (t <= 0) return A\n\t\tif (t >= 1) return B\n\n\t\t// Get the point (P) on the arc, then pick the nearest of A, B, and P\n\t\tconst P = _center.clone().add(point.clone().sub(_center).uni().mul(radius))\n\n\t\tlet distance = Infinity\n\t\tlet nearest: Vec2d | undefined\n\t\tfor (const pt of [A, B, P]) {\n\t\t\tif (point.dist(pt) < distance) {\n\t\t\t\tnearest = pt\n\t\t\t\tdistance = point.dist(pt)\n\t\t\t}\n\t\t}\n\n\t\tif (!nearest) throw Error('nearest point not found')\n\t\treturn nearest\n\t}\n\n\thitTestLineSegment(A: Vec2d, B: Vec2d, _zoom: number): boolean {\n\t\tconst { _center, radius, measure, angleStart, angleEnd } = this\n\t\tconst intersection = intersectLineSegmentCircle(A, B, _center, radius)\n\t\tif (intersection === null) return false\n\n\t\treturn intersection.some((p) => {\n\t\t\tconst result = getPointInArcT(measure, angleStart, angleEnd, _center.angle(p))\n\t\t\treturn result >= 0 && result <= 1\n\t\t})\n\t}\n\n\tgetVertices(): Vec2d[] {\n\t\tconst { _center, measure, length, radius, angleStart } = this\n\t\tconst vertices: Vec2d[] = []\n\n\t\tfor (let i = 0, n = getVerticesCountForLength(Math.abs(length)); i < n + 1; i++) {\n\t\t\tconst t = (i / n) * measure\n\t\t\tconst angle = angleStart + t\n\t\t\tvertices.push(_center.clone().add(new Vec2d(Math.cos(angle), Math.sin(angle)).mul(radius)))\n\t\t}\n\n\t\treturn vertices\n\t}\n}\n\n/**\n * Returns the t value of the point on the arc.\n *\n * @param mAB The measure of the arc from A to B, negative if counter-clockwise\n * @param A The angle from center to arc's start point (A) on the circle\n * @param B The angle from center to arc's end point (B) on the circle\n * @param P The point on the circle (P) to find the t value for\n *\n * @returns The t value of the point on the arc, with 0 being the start and 1 being the end\n *\n * @public\n */\nfunction getPointInArcT(mAB: number, A: number, B: number, P: number): number {\n\tlet mAP: number\n\tif (Math.abs(mAB) > PI) {\n\t\tmAP = shortAngleDist(A, P)\n\t\tconst mPB = shortAngleDist(P, B)\n\t\tif (Math.abs(mAP) < Math.abs(mPB)) {\n\t\t\treturn mAP / mAB\n\t\t} else {\n\t\t\treturn (mAB - mPB) / mAB\n\t\t}\n\t} else {\n\t\tmAP = shortAngleDist(A, P)\n\t\treturn mAP / mAB\n\t}\n}\n\n/**\n * Get the measure of an arc.\n *\n * @param A The angle from center to arc's start point (A) on the circle\n * @param B The angle from center to arc's end point (B) on the circle\n * @param sweepFlag 1 if the arc is clockwise, 0 if counter-clockwise\n * @param largeArcFlag 1 if the arc is greater than 180 degrees, 0 if less than 180 degrees\n *\n * @returns The measure of the arc, negative if counter-clockwise\n *\n * @public\n */\nfunction getArcMeasure(A: number, B: number, sweepFlag: number, largeArcFlag: number) {\n\tconst m = ((2 * ((B - A) % PI2)) % PI2) - ((B - A) % PI2)\n\tif (!largeArcFlag) return m\n\treturn (PI2 - Math.abs(m)) * (sweepFlag ? 1 : -1)\n}\n"],
  "mappings": "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",
  "names": []
}
