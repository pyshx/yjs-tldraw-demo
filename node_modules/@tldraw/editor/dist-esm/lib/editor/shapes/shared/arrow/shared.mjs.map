{
  "version": 3,
  "sources": ["../../../../../../src/lib/editor/shapes/shared/arrow/shared.ts"],
  "sourcesContent": ["import { TLArrowShape, TLArrowShapeTerminal, TLShape } from '@tldraw/tlschema'\nimport { Matrix2d } from '../../../../primitives/Matrix2d'\nimport { Vec2d } from '../../../../primitives/Vec2d'\nimport { Group2d } from '../../../../primitives/geometry/Group2d'\nimport { Editor } from '../../../Editor'\n\nexport function getIsArrowStraight(shape: TLArrowShape) {\n\treturn Math.abs(shape.props.bend) < 8 // snap to +-8px\n}\n\nexport type BoundShapeInfo<T extends TLShape = TLShape> = {\n\tshape: T\n\tdidIntersect: boolean\n\tisExact: boolean\n\tisClosed: boolean\n\ttransform: Matrix2d\n\toutline: Vec2d[]\n}\n\nexport function getBoundShapeInfoForTerminal(\n\teditor: Editor,\n\tterminal: TLArrowShapeTerminal\n): BoundShapeInfo | undefined {\n\tif (terminal.type === 'point') {\n\t\treturn\n\t}\n\n\tconst shape = editor.getShape(terminal.boundShapeId)!\n\tconst transform = editor.getShapePageTransform(shape)!\n\tconst geometry = editor.getShapeGeometry(shape)\n\n\t// This is hacky: we're only looking at the first child in the group. Really the arrow should\n\t// consider all items in the group which are marked as snappable as separate polygons with which\n\t// to intersect, in the case of a group that has multiple children which do not overlap; or else\n\t// flatten the geometry into a set of polygons and intersect with that.\n\tconst outline = geometry instanceof Group2d ? geometry.children[0].vertices : geometry.vertices\n\n\treturn {\n\t\tshape,\n\t\ttransform,\n\t\tisClosed: geometry.isClosed,\n\t\tisExact: terminal.isExact,\n\t\tdidIntersect: false,\n\t\toutline,\n\t}\n}\n\nexport function getArrowTerminalInArrowSpace(\n\teditor: Editor,\n\tarrowPageTransform: Matrix2d,\n\tterminal: TLArrowShapeTerminal\n) {\n\tif (terminal.type === 'point') {\n\t\treturn Vec2d.From(terminal)\n\t}\n\n\tconst boundShape = editor.getShape(terminal.boundShapeId)\n\n\tif (!boundShape) {\n\t\t// this can happen in multiplayer contexts where the shape is being deleted\n\t\treturn new Vec2d(0, 0)\n\t} else {\n\t\t// Find the actual local point of the normalized terminal on\n\t\t// the bound shape and transform it to page space, then transform\n\t\t// it to arrow space\n\t\tconst { point, size } = editor.getShapeGeometry(boundShape).bounds\n\t\tconst shapePoint = Vec2d.Add(point, Vec2d.MulV(terminal.normalizedAnchor, size))\n\t\tconst pagePoint = Matrix2d.applyToPoint(editor.getShapePageTransform(boundShape)!, shapePoint)\n\t\tconst arrowPoint = Matrix2d.applyToPoint(Matrix2d.Inverse(arrowPageTransform), pagePoint)\n\t\treturn arrowPoint\n\t}\n}\n\n/** @public */\nexport function getArrowTerminalsInArrowSpace(editor: Editor, shape: TLArrowShape) {\n\tconst arrowPageTransform = editor.getShapePageTransform(shape)!\n\n\tconst start = getArrowTerminalInArrowSpace(editor, arrowPageTransform, shape.props.start)\n\tconst end = getArrowTerminalInArrowSpace(editor, arrowPageTransform, shape.props.end)\n\n\treturn { start, end }\n}\n\n/** @internal */\nexport const MIN_ARROW_LENGTH = 32\n/** @internal */\nexport const BOUND_ARROW_OFFSET = 10\n/** @internal */\nexport const WAY_TOO_BIG_ARROW_BEND_FACTOR = 10\n\n/** @public */\nexport const STROKE_SIZES: Record<string, number> = {\n\ts: 2,\n\tm: 3.5,\n\tl: 5,\n\txl: 10,\n}\n"],
  "mappings": "AACA,SAAS,gBAAgB;AACzB,SAAS,aAAa;AACtB,SAAS,eAAe;AAGjB,SAAS,mBAAmB,OAAqB;AACvD,SAAO,KAAK,IAAI,MAAM,MAAM,IAAI,IAAI;AACrC;AAWO,SAAS,6BACf,QACA,UAC6B;AAC7B,MAAI,SAAS,SAAS,SAAS;AAC9B;AAAA,EACD;AAEA,QAAM,QAAQ,OAAO,SAAS,SAAS,YAAY;AACnD,QAAM,YAAY,OAAO,sBAAsB,KAAK;AACpD,QAAM,WAAW,OAAO,iBAAiB,KAAK;AAM9C,QAAM,UAAU,oBAAoB,UAAU,SAAS,SAAS,CAAC,EAAE,WAAW,SAAS;AAEvF,SAAO;AAAA,IACN;AAAA,IACA;AAAA,IACA,UAAU,SAAS;AAAA,IACnB,SAAS,SAAS;AAAA,IAClB,cAAc;AAAA,IACd;AAAA,EACD;AACD;AAEO,SAAS,6BACf,QACA,oBACA,UACC;AACD,MAAI,SAAS,SAAS,SAAS;AAC9B,WAAO,MAAM,KAAK,QAAQ;AAAA,EAC3B;AAEA,QAAM,aAAa,OAAO,SAAS,SAAS,YAAY;AAExD,MAAI,CAAC,YAAY;AAEhB,WAAO,IAAI,MAAM,GAAG,CAAC;AAAA,EACtB,OAAO;AAIN,UAAM,EAAE,OAAO,KAAK,IAAI,OAAO,iBAAiB,UAAU,EAAE;AAC5D,UAAM,aAAa,MAAM,IAAI,OAAO,MAAM,KAAK,SAAS,kBAAkB,IAAI,CAAC;AAC/E,UAAM,YAAY,SAAS,aAAa,OAAO,sBAAsB,UAAU,GAAI,UAAU;AAC7F,UAAM,aAAa,SAAS,aAAa,SAAS,QAAQ,kBAAkB,GAAG,SAAS;AACxF,WAAO;AAAA,EACR;AACD;AAGO,SAAS,8BAA8B,QAAgB,OAAqB;AAClF,QAAM,qBAAqB,OAAO,sBAAsB,KAAK;AAE7D,QAAM,QAAQ,6BAA6B,QAAQ,oBAAoB,MAAM,MAAM,KAAK;AACxF,QAAM,MAAM,6BAA6B,QAAQ,oBAAoB,MAAM,MAAM,GAAG;AAEpF,SAAO,EAAE,OAAO,IAAI;AACrB;AAGO,MAAM,mBAAmB;AAEzB,MAAM,qBAAqB;AAE3B,MAAM,gCAAgC;AAGtC,MAAM,eAAuC;AAAA,EACnD,GAAG;AAAA,EACH,GAAG;AAAA,EACH,GAAG;AAAA,EACH,IAAI;AACL;",
  "names": []
}
